---
- name: Load kernel modules required for Neutron
  include: modules.yml

- name: Set sysctl variables for Neutron
  sysctl:
    state: present
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    sysctl_set: yes
    ignoreerrors: true
  with_dict: "{{ neutron_sysctl }}"

- include: redhat.yml
  when: ansible_os_family == "RedHat"

- include: ubuntu.yml
  when: ansible_distribution == "Ubuntu"

- name: Create required OVS bridges
  openvswitch_bridge:
    bridge: "{{ item.split(':')[1] }}"
    fail_mode: secure
    state: present
  with_items: "{{ neutron_ovs_bridge_mappings.split(',') }}"

